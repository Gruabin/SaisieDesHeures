{% extends 'base.html.twig' %}

{% block title %}
Console d'approbation
{% endblock %}

{% block body %}
    {# Modal #}
    <dialog id="modalSuppr" class="modal">
        <div class="modal-box">
            <h3 class="font-bold text-lg"><i class="fa-solid fa-trash-can"></i> Supprimer</h3>
            <p class="py-4">Voulez vous supprimer cette saisie ?</p>
            <div class="modal-action">
                <button class="btn btn-accent" id="btnModalSuppr">Supprimer</button>
                <button class="btn noLoading" id="btnModalAnnuler" >Annuler</button>
            </div>
            <div class="text-center">
                <span id="modalLoading"></span>
            </div>
        </div>
    </dialog>
    {# --- #}
    <section data-turbo="false" class="mx-24 my-16 max-2xl:mx-8 max-lg:mx-4 max-sm:mx-1 rounded-md bg-neutral-100 border-b-[5px] border-gruau-red py-6 text-lg max-sm:text-base shadow-md">
        <h2 class="text-center text-4xl text-gruau-dark-blue font-bold">Console d'approbation</h2>
        <hr class="w-14 mx-auto h-[3px] bg-gruau-red my-6 text-gruau-red">
        <div class="flex flex-col lg:flex-row lg:items-center p-2">
            <div class="m-2 flex-1">
                <div class="m-2"><b>Site</b></div>
                <div class="m-2">{{ site }}</div>
            </div>
            <div class="m-2 flex-1">
                <div class="m-2"><b>Responsable</b></div>
                <div class="m-2" id="CDGUser">{{ user.id }} - {{ user.nomEmploye }} </div>
            </div>
            <div class="m-2 flex-1">
                    {{ form_start(formDate) }}
                <div class="m-2"><b>Date</b></div>
                <div class="flex">
                        {{ form_row(formDate.date, {'attr': {'class': 'select select-ghost', 'id': 'selectDate'}}) }}
                        {{ form_row(formDate.button, {'attr': {'class': 'btn btn-primary btn-sm m-2', 'id': 'submitDate', 'value': 'Appliquer la date'}}) }}
                </div>
                    {{ form_end(formDate) }}
            </div>
            <div class="m-2 flex-1">
                <div class="m-2"></div>
                <div class="m-2">
                    <b id="nbAnomalie">{{ nbAnomalie }}</b>
                    {% if nbAnomalie <= 2 %}
                        Anomalie
                    {% else %}
                        Anomalies
                    {% endif %}
                </div>
            </div>
            <div class="m-2 flex-1">
                <div class="m-2 font-bold">Liste de responsables</div>
                <div class="m-2">
                    {{ form_start(formResponsable) }}
                        {{ form_row(formResponsable.responsable, {'attr': {'class': 'bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5'}}) }}
                        <input type="hidden" name="token" id="loginToken" value="{{ csrf_token('loginToken') }}">
                        {{ form_row(formResponsable.button, {'attr': {'class': 'btn btn-primary btn-wide btn-sm'}}) }}
                    {{ form_end(formResponsable) }}
                </div>
            </div>
        </div>
    </section>
    <section class="mx-24 my-16 max-2xl:mx-8 max-lg:mx-4 max-sm:mx-1 rounded-md bg-neutral-100 border-b-[5px] border-gruau-red p-5 text-lg max-sm:text-base shadow-md">
        <div class="p-5 flex justify-between">
            <label class="label">
                <input type="checkbox" class="checkbox checkbox-primary" id="select_all"/>
                <span class="label-text">&nbsp; Tout sélectionner</span>
            </label>
        <label class="cursor-pointer label">
                <span class="label-text">Anomalies uniquement &nbsp;</span>
                <input type="checkbox" class="toggle toggle-accent" id="select_anomalies"/>
            </label>
        </div>
        <div class="flex flex-col items-center p-2" id="select_all_checkboxes">
        {% if employes is empty %}
            <h1 class="text-center m-5">Aucune saisie pour ce jour</h1>
        {% endif %}
        {# {% set lesEmployes = value %} #}
            {% for employe in employes %}
                    <div class="card bg-neutral-50 text-center shadow-lg mx-5 mb-10 p-3 w-full" id="tabEmploye" data-employe="{{ employe.id }}">
                        <div class="flex justify-between m-3">
                            <div class="flex flex-col mx-3">
                                <h1 class="text-primary">{{ employe.id }} - {{ employe.nom }} </h1>
                            </div>
                            <div class="mx-3">
                            {# +0 permet de faire un calcul pour arrondir la donnée #}
                                <b id="tempsTotal">{{ employe.total + 0 }} h </b>
                            </div>
                        </div>
                        {# Tableau #}
                        <div class="overflow-x-auto">
                            <table class="table table-fixed">
                            {% block thead %}
                                {% include 'console/head.table.html.twig' %}
                            {% endblock %}
                            {% block tbody %}
                                {% include 'console/body.table.html.twig' %}
                            {% endblock %}
                            </table>
                        </div>
                    </div>
            {% endfor %}
        </div>
    </section>
    <input type="hidden" name="token" id="approbationToken" value="{{ csrf_token('approbationToken') }}">
    <div class="flex gap-10 justify-center text-center m-16">
        <a type="button" id="quitter" class="btn btn-primary btn-wide"  href="{{ path('deconnexion') }}">Quitter</a>
        <span id="loading" class=""></span>
        <button type="button" id="validation" class="btn btn-primary btn-wide ">Approuver la selection</button>
    </div>
{% endblock %}
