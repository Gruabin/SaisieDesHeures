{% extends 'base.html.twig' %}
{% block title %}
    Saisie des heures
{% endblock %}
{% block body %}
    <section class="card mx-24 my-4 max-2xl:mx-8 max-lg:mx-4 max-sm:mx-1 bg-base-100 border-b-[5px] border-accent text-lg max-sm:text-base" id="temps">
        <div class="card-body">
            <div class="flex flex-row items-center max-sm:text-center">
                <div class="m-2 flex-1">
                    <div class="m-2">
                        <b>Employé</b>
                    </div>
                    <div id="codeEmploye" class="m-2">{{ app.user.id }}
                        {{ app.user.nomEmploye }}</div>
                </div>
                <div class="m-2 flex-1 md:block hidden">
                    <div class="m-2">
                        <b>Centre de charge</b>
                    </div>
                    <div class="m-2" id="CDGUser">
                        {{ app.user.centreDeCharge.id }}
                    </div>
                </div>
                <div class="m-2 flex-1 md:block hidden">
                    <div class="m-2">
                        <b>Date</b>
                    </div>
                    <div class="m-2">
                        {{ 'now'|date('d/m/Y', 'Europe/Paris') }}
                    </div>
                </div>
                <div class="m-2 flex-1">
                    <div class="m-2">
                        <b>Temps journalier</b>
                    </div>
                    <div class="m-2">
                        <span>
                            {% if nbHeures > 0 %}
                                {{ nbHeures }}
                                {% if nbHeures < 2 %}
                                    heure
                                {% else %}
                                    heures
                                {% endif %}
                            {% endif %}
                        </span>
                    </div>
                </div>
                <div class="m-2 flex-1 md:block hidden">
                    <div class="m-2">
                        <a target="_self" class="btn btn-primary mt-5" id="btnConsulterDetails" href="{{ path('historique') }}">
                            Consulter le détail
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <section class="card mx-24 my-4 max-2xl:mx-8 max-lg:mx-4 max-sm:mx-1 bg-base-100 border-b-[5px] border-accent text-lg max-sm:text-base">
        <div class="card-body">
            <div class="flex flex-col flex-wrap max-sm:items-center text-center">
                <div class="w-fit self-center">
                    <div id="alertSuccess" role="alert" class="alert alert-success hidden">
                        <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                        <span></span>
                    </div>
                    <div id="alertError" role="alert" class="alert alert-error hidden">
                        <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                        <span>Une erreur est survenue. Veuillez contacter le <a href="https://supportinfo.gruau.com/glpi/plugins/formcreator/front/wizard.php" class="underline noLoading" target="_blank">Support informatique</a>.</span>
                    </div>
                </div>
                <div class=" flex md:flex-row flex-col" id="divType">
                    <div class="flex-1 text-center md:text-right md:self-center m-3">
                        <label for="type">
                            <b>Type d'heures</b>
                        </label>
                    </div>
                    <div class="flex-1 text-center flex items-center">
                        <div class="self-center">
                            <select class="select mx-3 w-auto dark:border-primary" {% if nbHeures >= 12 %}disabled{% endif %} name="type" id="type">
                                <option value="-1" {% if favoriTypeHeure is null %}selected{% endif %}>-- Sélectionner un type d'heure --</option>
                                {% for type in types %}
                                    {% if favoriTypeHeure is not null and favoriTypeHeure.typeHeure is not null %}
                                        <option {% if favoriTypeHeure.typeHeure.id == type.id %}selected{% endif %} value="{{ type.id }}">{{ type.nomType }}</option>
                                    {% else %}
                                        <option value="{{ type.id }}">{{ type.nomType }}</option>
                                    {% endif %}
                                {% endfor %}
                            </select>
                            <div class="tooltip" data-tip="Enregistrer par défaut">
                                <button class="btn btn-sm btn-success" id="btnEnregistrerParDefaut">
                                    <span id="iconTransparent" class="w-4 hidden">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M48 96V416c0 8.8 7.2 16 16 16H384c8.8 0 16-7.2 16-16V170.5c0-4.2-1.7-8.3-4.7-11.3l33.9-33.9c12 12 18.7 28.3 18.7 45.3V416c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V96C0 60.7 28.7 32 64 32H309.5c17 0 33.3 6.7 45.3 18.7l74.5 74.5-33.9 33.9L320.8 84.7c-.3-.3-.5-.5-.8-.8V184c0 13.3-10.7 24-24 24H104c-13.3 0-24-10.7-24-24V80H64c-8.8 0-16 7.2-16 16zm80-16v80H272V80H128zm32 240a64 64 0 1 1 128 0 64 64 0 1 1 -128 0z"/></svg>
                                    </span>
                                    <span id="iconPlein" class="w-4 hidden">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M64 32C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V173.3c0-17-6.7-33.3-18.7-45.3L352 50.7C340 38.7 323.7 32 306.7 32H64zm0 96c0-17.7 14.3-32 32-32H288c17.7 0 32 14.3 32 32v64c0 17.7-14.3 32-32 32H96c-17.7 0-32-14.3-32-32V128zM224 288a64 64 0 1 1 0 128 64 64 0 1 1 0-128z"/></svg>
                                    </span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class=" hidden flex md:flex-row flex-col" id="divOrdre">
                    <div class="flex-1 text-center md:text-right md:self-center m-3">
                        <label for="ordre">
                            <b>Ordre</b>
                        </label>
                    </div>
                    <div class="flex-1 text-left items-center">
                        <label class="input flex items-center gap-2 mx-3 max-w-40 dark:border-primary">
                            <span id="labelOrdre">{{ site }}</span>
                            <input type="text" name="ordre" id="ordre" class="w-28" maxlength="9" pattern="^[0-9A-Za-z]{2}[0-9]{5}$"/>
                        </label>
                    </div>
                </div>
                <div class=" hidden flex md:flex-row flex-col" id="divActivite">
                    <div class="flex-1 text-center md:text-right md:self-center m-3">
                        <label for="activite">
                            <b>Activité</b>
                        </label>
                    </div>
                    <div class="flex-1 text-left md:self-center items-center">
                        <input class="input mx-3 dark:border-primary" type="text" name="activite" id="activite" maxlength="4" pattern="^[0-9]{4}$">
                        <p class="mx-3" id="infoActivite"></p>
                    </div>
                </div>
                <div class=" hidden flex md:flex-row flex-col max-sm:items-center" id="divTache">
                    <div class="flex-1 text-center md:text-right md:self-center m-3">
                        <label for="tache">
                            <b>Tâche</b>
                        </label>
                    </div>
                    <div class="flex-1 text-left md:flex md:self-center items-center">
                        <div class="md:self-center">
                            <select class="select mx-3 dark:border-primary" name="tache" id="tache">
                                <option value="-1">-- Sélectionner une tâche --</option>
                                {% for tache in taches %}
                                    <option data-idtype="{{ tache.typeHeures.id }}" value="{{ tache.id }}">{{ tache.id }}
                                        -
                                        {{ tache.nomTache }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>
                <div class=" hidden flex md:flex-row flex-col" id="divOperation">
                    <div class="flex-1 text-center md:text-right md:self-center m-3">
                        <label  for="operation">
                            <b>Opération</b>
                        </label>
                    </div>
                    <div class="flex-1 text-left md:self-center  items-center">
                        <input class="input mx-3 dark:border-primary max-w-16" type="number" name="operation" id="operation" max="999" min="0" step="10">
                    </div>
                </div>
                <div class=" hidden flex md:flex-row flex-col max-sm:items-center" id="divTacheSpe">
                    <div class="flex-1 text-center md:text-right md:self-center m-3">
                        <label for="tacheSpe">
                            <b>Tâche spécifique</b>
                        </label>
                    </div>
                    <div class="flex-1 flex text-left md:flex md:self-center items-center">
                        <div class="mx-3 flex gap-2 items-center">
                            <input type="checkbox" class="checkbox checkbox-primary dark:border-primary" id="cbTacheSpe"/>
                            <select class="select dark:border-primary" disabled name="tacheSpe" id="tacheSpe">
                                <option value="-1" selected>-- Sélectionner une tâche spécifique --</option>
                                {% for tache in tachesSpe %}
                                    <option value="{{ tache.id }}">{{ tache.id }}
                                        -
                                        {{ tache.description }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>
                <div class=" hidden flex md:flex-row flex-col" id="divCentreCharge">
                    <div class="flex-1 text-center md:text-right md:self-center m-3">
                        <label for="centrecharge">
                            <b>Centre de charge</b>
                        </label>
                    </div>
                    <div class="flex-1 text-left md:flex md:self-center items-center">
                        <select class="select mx- dark:border-primary" name="centrecharge" id="centrecharge">
                            {% for centre_charge in CDG %}
                                <option value="{{ centre_charge.id }}">{{ centre_charge.id }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class=" hidden flex md:flex-row flex-col" id="divSaisieTemps">
                    <div class="flex-1 text-center md:text-right md:self-center m-3">
                        <label for="saisieTemps">
                            <b>Temps main d'oeuvre (en h)</b>
                        </label>
                    </div>
                    <div class="flex-1 md:flex md:self-center items-center">
                        <input class="input mx-3 dark:border-primary max-w-24" type="number" max="100" step=".25" name="saisieTemps" id="saisieTemps">
                    </div>
                </div>
                <div class="flex flex-row flex-wrap justify-center items-center p-2">
                    <div id="informationSaisiHeures"></div>
                </div>
            </div>
            <input type="hidden" name="token" id="saisieToken" value="{{ csrf_token('saisieToken') }}">
            <div class="flex flex-row  justify-center items-center p-2 gap-2">
                <a target="_self" class="btn btn-accent btn-outline mt-5" id="btnReturn" href="{{ path('deconnexion') }}">
                    Quitter
                </a>
                <button class="btn btn-primary mt-5 {% if nbHeures >= 12 %}btn-disabled{% endif %}" id="btnEnregistrerQuitter">
                    Enregistrer et quitter
                </button>
                <button class="btn btn-primary mt-5 {% if nbHeures >= 12 %}btn-disabled{% endif %}" id="btnEnregistrerContinue">
                    Enregistrer
                </button>
            </div>
        </div>
    </section>
{% endblock %}
